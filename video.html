<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV Player</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
    --bg:#000;
    --card:#121212;
    --text:#fff;
    --accent:#2196F3;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}

body{
    background:var(--bg);
    color:var(--text);
    height:100vh;
    display:flex;
    flex-direction:column;
    overflow:hidden;
}

/* HEADER */
.header{
    height:50px;
    display:flex;
    align-items:center;
    gap:15px;
    padding:0 15px;
    border-bottom:1px solid #222;
    flex-shrink:0;
}

/* PLAYER */
.video-fixed-top{
    width:100%;
    aspect-ratio:16/9;
    background:#000;
    position:relative;
    flex-shrink:0;
}
video{width:100%;height:100%}

/* ACTION FIXED */
.fixed-actions{
    position:sticky;
    top:0;
    background:#000;
    z-index:5;
    border-bottom:1px solid #222;
}

.info-section{
    padding:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.total-badge{
    background:#111;
    padding:4px 10px;
    border-radius:20px;
    font-size:.75rem;
    color:var(--accent);
}

.action-row{
    display:flex;
    justify-content:space-around;
    padding:12px 0;
    border-top:1px solid #222;
}
.act-btn{
    text-align:center;
    font-size:.75rem;
    cursor:pointer;
}
.act-btn i{font-size:1.3rem;margin-bottom:5px;display:block}

/* SCROLL AREA */
.scrollable-content{
    flex:1;
    overflow-y:auto;
    padding:15px;
}

/* CHANNEL LIST */
.channel-row{
    display:flex;
    align-items:center;
    gap:12px;
    background:var(--card);
    padding:10px 12px;
    border-radius:12px;
    border:1px solid #222;
    margin-bottom:10px;
    cursor:pointer;
}
.channel-row.active{border-color:var(--accent)}

.channel-logo{
    width:45px;
    height:45px;
    border-radius:8px;
    background:#222;
    object-fit:contain;
}

.channel-name{flex:1}

.star-btn{
    font-size:1.1rem;
    color:#888;
}
.star-btn.active{color:var(--accent)}
</style>
</head>

<body>

<div class="header">
    <i class="fas fa-arrow-left" onclick="history.back()"></i>
    <span>Live Stream</span>
</div>

<div class="video-fixed-top">
    <video id="video" playsinline></video>
</div>

<!-- FIXED INFO + ACTION -->
<div class="fixed-actions">
    <div class="info-section">
        <div>
            <h3 id="currentTitle">Select Channel</h3>
            <small>Watching Live stream</small>
        </div>
        <div class="total-badge" id="totalCount">Total: 0</div>
    </div>

    <div class="action-row">
        <div class="act-btn" onclick="shareChannel()"><i class="fas fa-share-alt"></i>Share</div>
        <div class="act-btn"><i class="fas fa-star"></i>My List</div>
        <div class="act-btn" onclick="window.open('https://t.me/yourchannel')"><i class="fab fa-telegram"></i>Telegram</div>
    </div>
</div>

<!-- ONLY THIS SCROLLS -->
<div class="scrollable-content" id="list"></div>

<script>
const video=document.getElementById('video');
let hls=new Hls();

/* MY LIST */
function getFav(){return JSON.parse(localStorage.getItem('fav')||'[]')}
function saveFav(d){localStorage.setItem('fav',JSON.stringify(d))}

function toggleFav(name,icon){
    let f=getFav();
    if(f.includes(name)){
        f=f.filter(x=>x!==name);
        icon.classList.remove('active');
    }else{
        f.push(name);
        icon.classList.add('active');
    }
    saveFav(f);
}

/* SHARE */
function shareChannel(){
    const t=currentTitle.innerText;
    navigator.share?
    navigator.share({title:t,text:t,url:location.href}):
    (navigator.clipboard.writeText(t),alert("Copied"));
}

/* LOAD PLAYLIST */
const playlist=new URLSearchParams(location.search).get('playlist');
fetch(playlist).then(r=>r.text()).then(data=>{
    const lines=data.split('\n');
    let list=[],c={};
    lines.forEach(l=>{
        if(l.startsWith('#EXTINF')){
            c.name=l.split(',')[1];
            const m=l.match(/tvg-logo="([^"]*)"/);
            c.logo=m?m[1]:'https://via.placeholder.com/100?text=TV';
        }else if(l.startsWith('http')){
            c.url=l.trim();
            list.push({...c});c={};
        }
    });
    totalCount.innerText="Total: "+list.length;
    render(list);
});

function render(arr){
    const f=getFav();
    arr.forEach((c,i)=>{
        const d=document.createElement('div');
        d.className='channel-row';
        d.innerHTML=`
            <img class="channel-logo" src="${c.logo}">
            <div class="channel-name">${c.name}</div>
            <i class="fas fa-star star-btn ${f.includes(c.name)?'active':''}"></i>
        `;
        d.onclick=()=>{
            play(c.url,c.name);
            document.querySelectorAll('.channel-row').forEach(x=>x.classList.remove('active'));
            d.classList.add('active');
        };
        d.querySelector('.star-btn').onclick=(e)=>{
            e.stopPropagation();
            toggleFav(c.name,e.target);
        };
        list.appendChild(d);
        if(i===0)d.click();
    });
}

function play(url,name){
    currentTitle.innerText=name;
    hls.destroy();hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
}
</script>

</body>
</html>
