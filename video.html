<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro TV Player</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
  --bg:#000;
  --card:#121212;
  --accent:#2196F3;
  --text:#fff;
}

*{margin:0;padding:0;box-sizing:border-box;font-family: Arial, sans-serif}
body{ background:var(--bg); color:var(--text); height:100vh; display:flex; flex-direction:column; overflow:hidden; }

/* HEADER */
.header{ height:50px; display:flex; align-items:center; justify-content: space-between; padding:0 15px; border-bottom:1px solid #222; }
.back-btn { font-size: 1.5rem; cursor: pointer; color: #fff; }
.digital-clock { font-size: 0.75rem; color: #bbb; opacity: 0; transition: 0.3s; }

/* PLAYER */
.player-wrap{ position:relative; width:100%; aspect-ratio:16/9; background:#000; overflow: hidden;}
video{ width:100%; height:100%; object-fit: contain; }

/* LOADER */
.loader {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 30px; height: 30px; border: 3px solid #333; border-top: 3px solid var(--accent);
    border-radius: 50%; animation: spin 1s linear infinite; display: none; z-index: 5;
}
@keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }

/* BOTTOM CONTROLS */
.controls-overlay {
    position: absolute; inset: 0; background: rgba(0,0,0,0.3);
    opacity: 0; visibility: hidden; transition: 0.3s; z-index: 10;
}
.controls-overlay.show { opacity: 1; visibility: visible; }

.bottom-bar {
    position: absolute; bottom: 0; width: 100%; padding: 10px 12px;
    background: linear-gradient(transparent, rgba(0,0,0,0.9));
    display: flex; align-items: center; justify-content: space-between;
}

.mini-btns { display: flex; align-items: center; gap: 18px; }
.mini-btns i { font-size: 1.1rem; color: #fff; cursor: pointer; }
#pp { font-size: 1.3rem; width: 20px; text-align: center; } /* Play button specific */

.right-side { display: flex; align-items: center; gap: 15px; }
#vTime { font-size: 0.7rem; color: #ddd; min-width: 35px; }
.right-side i { font-size: 1rem; color: #fff; cursor: pointer; }

/* INFO SECTION */
.info{ padding:12px 15px; display:flex; justify-content:space-between; align-items: center; }
.channel-meta { display: flex; align-items: center; gap: 10px; }
.mini-logo { width: 35px; height: 35px; border-radius: 50%; border: 1px solid #333; object-fit: contain; }
.info h3 { font-size: 0.95rem; }
.badge{ background:#111; padding:3px 10px; border-radius:15px; color:var(--accent); font-size:.65rem; border: 1px solid #222; }

/* ACTIONS */
.actions{ display:flex; justify-content:space-around; padding:10px 0; border-top:1px solid #222; border-bottom:1px solid #222; }
.actions div{ text-align:center; font-size:.75rem; cursor:pointer; flex: 1; }
.actions i{ display:block; font-size:1.2rem; margin-bottom:4px; }

/* LIST */
.list{ flex:1; overflow-y:auto; padding:10px 15px; }
.row{ display:flex; align-items:center; gap:10px; background:var(--card); padding:8px; border-radius:8px; margin-bottom:8px; cursor:pointer; }
.row.active{ border-left: 3px solid var(--accent); background: #0d2233; }
.logo-circle{ width:35px; height:35px; border-radius:50%; overflow: hidden; border: 1px solid #333; flex-shrink: 0;}
.logo-circle img{ width:100%; height:100%; object-fit: contain; }
.name{ flex:1; font-size: 0.85rem; }
</style>
</head>

<body>

<div class="header">
  <div class="back-btn" onclick="history.back()"><i class="fas fa-arrow-left"></i></div>
  <div class="digital-clock" id="clockBox"><span id="fullDateTime"></span></div>
</div>

<div class="player-wrap" id="playerArea">
  <div class="loader" id="loader"></div>
  <video id="video" playsinline></video>
  
  <div class="controls-overlay" id="controls">
    <div class="bottom-bar">
        <div class="mini-btns">
            <i class="fas fa-backward" onclick="event.stopPropagation(); seek(-10)"></i>
            <i class="fas fa-play" id="pp" onclick="event.stopPropagation(); togglePlay()"></i>
            <i class="fas fa-forward" onclick="event.stopPropagation(); seek(10)"></i>
        </div>
        
        <div class="right-side">
            <span id="vTime">00:00</span>
            <i class="fas fa-volume-up" id="vBtn" onclick="event.stopPropagation(); toggleMute()"></i>
            <i class="fas fa-expand" onclick="event.stopPropagation(); toggleFull()"></i>
        </div>
    </div>
  </div>
</div>

<div class="info">
    <div class="channel-meta">
      <img id="currentLogo" class="mini-logo" src="https://i.imgur.com/8Qf6Y0L.png">
      <div>
        <h3 id="title">Select Channel</h3>
        <small style="color:#888; font-size:0.7rem;">Live Streaming 24/7</small>
      </div>
    </div>
    <div class="badge" id="count">Total: 0</div>
</div>

<div class="actions">
    <div onclick="copyLink()"><i class="fas fa-share-nodes"></i>Share</div>
    <div onclick="filterFavorites()"><i class="far fa-star"></i>My List</div>
    <div onclick="window.open('https://t.me/bestiptvlive')"><i class="fas fa-paper-plane"></i>Join Telegram</div>
</div>

<div class="list" id="list"></div>

<script>
const video=document.getElementById('video'), controls=document.getElementById('controls');
const clockBox=document.getElementById('clockBox'), loader=document.getElementById('loader');
const pp=document.getElementById('pp'), listArea = document.getElementById('list');
let hls=new Hls(), allChannels = [], hideTimeout;

/* ১. স্মার্ট হাইড (৩ সেকেন্ড) */
function showControls() {
    controls.classList.add('show');
    clockBox.style.opacity = "1";
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
        controls.classList.remove('show');
        clockBox.style.opacity = "0";
    }, 3000);
}
playerArea.onclick = showControls;

/* ২. টাইম ও ঘড়ি */
function updateClock() {
    const options = { weekday: 'short', day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
    document.getElementById('fullDateTime').innerText = new Date().toLocaleString('en-GB', options);
}
setInterval(updateClock, 1000);

video.ontimeupdate = () => {
    let m = Math.floor(video.currentTime / 60), s = Math.floor(video.currentTime % 60);
    document.getElementById('vTime').innerText = (m<10?'0'+m:m) + ":" + (s<10?'0'+s:s);
};

/* ৩. ভিডিও ফাংশনস */
function togglePlay(){
    if(video.paused){ video.play(); pp.className="fas fa-pause"; }
    else{ video.pause(); pp.className="fas fa-play"; }
    showControls();
}
function seek(t){ video.currentTime+=t; showControls(); }
function toggleMute(){
    video.muted = !video.muted;
    document.getElementById('vBtn').className = video.muted ? "fas fa-volume-mute" : "fas fa-volume-up";
}
function toggleFull(){
    if(video.requestFullscreen) video.requestFullscreen();
    else if(video.webkitRequestFullscreen) video.webkitRequestFullscreen();
}

/* ৪. লোডিং অ্যানিমেশন */
video.onloadstart = () => loader.style.display = "block";
video.onplaying = () => loader.style.display = "none";
video.onwaiting = () => loader.style.display = "block";

/* ৫. ডাটা রেন্ডার */
const url=new URLSearchParams(location.search).get('playlist');
if(url){
    fetch(url).then(r=>r.text()).then(data=>{
      const lines=data.split('\n');
      let arr=[],c={};
      lines.forEach(l=>{
        if(l.startsWith('#EXTINF')){
          c.name=l.split(',')[1]||"Unknown";
          const m=l.match(/tvg-logo="([^"]*)"/);
          c.logo= (m && m[1]) ? m[1] : "https://i.imgur.com/8Qf6Y0L.png";
        }else if(l.trim().startsWith('http')){
          c.url=l.trim(); arr.push({...c}); c={};
        }
      });
      allChannels = arr; render(allChannels);
    });
}

function render(arr){
  listArea.innerHTML = "";
  document.getElementById('count').innerText = "Total: " + arr.length;
  arr.forEach((c,i)=>{
    const d=document.createElement('div');
    d.className="row";
    d.innerHTML=`<div class="logo-circle"><img src="${c.logo}" onerror="this.src='https://i.imgur.com/8Qf6Y0L.png'"></div><div class="name">${c.name}</div><i class="far fa-star"></i>`;
    d.onclick=()=>{
        play(c.url, c.name, c.logo);
        document.querySelectorAll('.row').forEach(x=>x.classList.remove('active'));
        d.classList.add('active');
    };
    listArea.appendChild(d);
    if(i===0 && !video.src) d.click();
  });
}

function play(url, name, logo){
  document.getElementById('title').innerText=name;
  document.getElementById('currentLogo').src=logo;
  loader.style.display = "block";
  if(Hls.isSupported()){
      hls.destroy(); hls=new Hls();
      hls.loadSource(url); hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
  } else { video.src = url; video.play(); }
  pp.className="fas fa-pause";
}

function copyLink(){ navigator.clipboard.writeText(video.src); alert("Link Copied!"); }
</script>
</body>
</html>
