<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro TV Player</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
  --bg:#000;
  --card:#121212;
  --accent:#2196F3;
  --fav:#ff4b2b;
  --text:#fff;
}

*{margin:0;padding:0;box-sizing:border-box;font-family: Arial, sans-serif}

body{
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* HEADER */
.header{
  height:60px;
  display:flex;
  align-items:center;
  justify-content: space-between;
  padding:0 15px;
  background: #000;
  border-bottom:1px solid #222;
}
.back-btn {
    font-size: 1.8rem;
    font-weight: 900;
    cursor: pointer;
    color: #fff;
}
.digital-clock {
    font-size: 0.85rem;
    color: #bbb;
}

/* PLAYER AREA */
.player-wrap{
  position:relative;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
}
video{width:100%;height:100%; object-fit: contain;}

/* প্লেয়ারের ভেতর ইমেজ (Watermark) - আরও উপরে তোলা হয়েছে */
.player-image {
    position: absolute;
    bottom: 40px; /* ১০ থেকে বাড়িয়ে ৪০ করা হয়েছে */
    right: 15px;
    width: 70px; 
    height: auto;
    z-index: 5;
    pointer-events: none;
    opacity: 0.9;
    background: transparent; /* ব্যাকগ্রাউন্ড রিমুভ নিশ্চিত করতে */
}

/* লোডিং অ্যানিমেশন */
.loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    border: 5px solid #333;
    border-top: 5px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: none;
    z-index: 10;
}
@keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

.controls{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.5);
  display:flex;
  flex-direction: column;
  justify-content:center;
  align-items:center;
  opacity:0;
  visibility: hidden;
  transition:.2s;
  z-index: 15;
}
.controls.show{ opacity:1; visibility: visible; }
.mid-ctrl i{ font-size:2.5rem; cursor:pointer; margin: 0 15px; color: #fff;}

/* INFO SECTION */
.info{
  padding:15px;
  display:flex;
  justify-content:space-between;
}
.info h3 { font-size: 1.1rem; }
.badge{
  background:#111;
  padding:4px 12px;
  border-radius:20px;
  color:var(--accent);
  font-size:.75rem;
  border: 1px solid #222;
}

/* ACTIONS */
.actions{
  display:flex;
  justify-content:space-around;
  padding:15px 0;
  border-top:1px solid #222;
  border-bottom:1px solid #222;
}
.actions div{ text-align:center; font-size:.85rem; cursor:pointer; color: #fff; flex: 1; }
.actions i{ display:block; font-size:1.6rem; margin-bottom:8px; }

/* LIST */
.list{ flex:1; overflow-y:auto; padding:15px; }
.row{
  display:flex;
  align-items:center;
  gap:12px;
  background:var(--card);
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
  cursor:pointer;
}
.row.active{ background: linear-gradient(90deg, #121212 0%, #0d2233 100%); }
.logo-circle{ width:45px; height:45px; border-radius:50%; overflow: hidden; background: #000; flex-shrink: 0; border: 1px solid #333;}
.logo-circle img{ width:100%; height:100%; object-fit: contain; }
.name{ flex:1; font-size: 0.95rem; }
.star{ font-size:1.3rem; color:#444; padding: 5px; transition: 0.3s;}
.star.active{ color:var(--fav); }
</style>
</head>

<body>

<div class="header">
  <div class="back-btn" onclick="handleBack()">
    <i class="fas fa-arrow-left"></i>
  </div>
  <div class="digital-clock">
    <span id="fullDateTime">Loading...</span>
  </div>
</div>

<div class="player-wrap" id="playerArea">
  <div class="loader" id="videoLoader"></div>
  <img src="https://i.postimg.cc/2SHhhg7v/20260203-004053.png" class="player-image" alt="logo">
  <video id="video" playsinline></video>
  
  <div class="controls" id="controls">
    <div class="mid-ctrl">
        <i class="fas fa-backward" onclick="event.stopPropagation(); seek(-10)"></i>
        <i class="fas fa-play" id="pp" onclick="event.stopPropagation(); togglePlay()"></i>
        <i class="fas fa-forward" onclick="event.stopPropagation(); seek(10)"></i>
    </div>
  </div>
</div>

<div class="fixed">
  <div class="info">
    <div>
      <h3 id="title">Select Channel</h3>
      <small style="color: #888;">Watch this channel live streaming 24/7.</small>
    </div>
    <div class="badge" id="count">Total: 0</div>
  </div>

  <div class="actions">
    <div onclick="copyLink()"><i class="fas fa-share-nodes"></i><br>Share</div>
    <div id="myListTab" onclick="filterFavorites()"><i class="far fa-star"></i><br>My List</div>
    <div onclick="window.open('https://t.me/bestiptvlive')"><i class="fas fa-paper-plane"></i><br>Join Telegram</div>
  </div>
</div>

<div class="list" id="list"></div>

<script>
const video=document.getElementById('video');
const controls=document.getElementById('controls');
const loader=document.getElementById('videoLoader');
const listArea = document.getElementById('list');
let hls=new Hls(), allChannels = [], currentUrl = "";

/* ১. টাইম আপডেট */
function updateClock() {
    const now = new Date();
    const options = { weekday: 'short', day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
    document.getElementById('fullDateTime').innerText = now.toLocaleString('en-GB', options);
}
setInterval(updateClock, 1000); updateClock();

/* ২. প্লেয়ার কন্ট্রোল ও লোডিং */
playerArea.onclick = () => controls.classList.toggle('show');

video.onwaiting = () => { loader.style.display = "block"; };
video.onplaying = () => { loader.style.display = "none"; };
video.onloadstart = () => { loader.style.display = "block"; };

function togglePlay(){
  if(video.paused){ video.play(); document.getElementById('pp').className="fas fa-pause"; }
  else{ video.pause(); document.getElementById('pp').className="fas fa-play"; }
}
function seek(t){ video.currentTime+=t; }

function handleBack() {
    if(document.getElementById('myListTab').classList.contains('active-filter')) showAllChannels();
    else history.back();
}

/* ৩. ডাটা লোডিং ও রেন্ডার */
const url=new URLSearchParams(location.search).get('playlist');
if(url){
    fetch(url).then(r=>r.text()).then(data=>{
      const lines=data.split('\n');
      let arr=[],c={};
      lines.forEach(l=>{
        if(l.startsWith('#EXTINF')){
          c.name=l.split(',')[1]||"Unknown";
          const m=l.match(/tvg-logo="([^"]*)"/);
          c.logo= (m && m[1]) ? m[1] : "https://i.imgur.com/8Qf6Y0L.png";
        }else if(l.trim().startsWith('http')){
          c.url=l.trim(); arr.push({...c}); c={};
        }
      });
      allChannels = arr; render(allChannels);
    });
}

function render(arr, isFavView){
  const favs = JSON.parse(localStorage.getItem("my_fav_channels")||"[]");
  listArea.innerHTML = "";
  document.getElementById('count').innerText = "Total: " + arr.length;

  arr.forEach((c,i)=>{
    const isFav = favs.some(x => x.url === c.url);
    const d=document.createElement('div');
    d.className="row";
    d.innerHTML=`
      <div class="logo-circle"><img src="${c.logo}" onerror="this.src='https://i.imgur.com/8Qf6Y0L.png'"></div>
      <div class="name">${c.name}</div>
      <i class="${isFav?'fas':'far'} fa-star star ${isFav?'active':''}"></i>
    `;
    d.onclick=()=>{
      play(c.url,c.name);
      document.querySelectorAll('.row').forEach(x=>x.classList.remove('active'));
      d.classList.add('active');
    };
    listArea.appendChild(d);
    if(i===0 && !video.src && !isFavView) d.click();
  });
}

function play(url,name){
  currentUrl = url;
  document.getElementById('title').innerText=name;
  loader.style.display = "block";
  if(Hls.isSupported()){
      hls.destroy(); hls=new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
  } else {
      video.src = url; video.play();
  }
}

function copyLink(){
  if(currentUrl){ navigator.clipboard.writeText(currentUrl); alert("Link Copied!"); }
}

function filterFavorites() {
    const favs = JSON.parse(localStorage.getItem("my_fav_channels")||"[]");
    document.getElementById('myListTab').classList.add('active-filter');
    render(favs, true);
}

function showAllChannels() {
    document.getElementById('myListTab').classList.remove('active-filter');
    render(allChannels, false);
}
</script>

</body>
</html>
